' ********** Copyright 2016 Roku Corp.  All Rights Reserved. ********** 

sub init()
    m.feedList = m.top.findNode("feedList")
    m.loadingIndicator = m.top.findNode("loadingIndicator")
    m.loadingIndicator.opacity = 1.0
    fetch()
end sub

sub fetch()
    m.downloadFeedTask = CreateObject("roSGNode", "FeedDownloader")
    m.downloadFeedTask.observeField("content", "setContent")
    m.downloadFeedTask.control = "RUN"
    m.top.setFocus(true)
end sub

sub setContent():
    m.feedList.content = m.downloadFeedTask.content
    m.loadingIndicator.opacity = 0.0
end sub

function onKeyEvent(key as String, press as Boolean) as Boolean
    ? "onKeyEvent"
    handled = false

    if (press)
        if (key = "play")
            handled = true
            m.videoPlayer.control = "play"
        end if
        if (key = "pause")
            handled = true
            m.videoPlayer.control = "pause"
        end if
        if (key = "OK")
            handled = true
            openYoutube()
        end if
    end if
    return handled
end function

sub openYoutube()
    m.downloadFeedTask = CreateObject("roSGNode", "YoutubeLinkOpener")
    m.downloadFeedTask.observeField("content", "setContent")
    m.downloadFeedTask.control = "RUN"
end sub
