' ********** Copyright 2016 Roku Corp.  All Rights Reserved. ********** 

sub init()
    m.feedList = m.top.findNode("feedList")
    m.loadingIndicator = m.top.findNode("loadingIndicator")
    m.loadingIndicator.opacity = 1.0
    fetch()
end sub

sub fetch()
    m.downloadFeedTask = CreateObject("roSGNode", "FeedDownloader")
    m.downloadFeedTask.observeField("content", "setContent")
    m.downloadFeedTask.control = "RUN"
    m.top.setFocus(true)
end sub

sub setContent():
    m.feedList.content = m.downloadFeedTask.content
    m.loadingIndicator.opacity = 0.0
end sub

function onKeyEvent(key as String, press as Boolean) as Boolean
    print "onKeyEvent"
    handled = false

    if (press)
        if (key = "play")
            handled = true
            m.videoPlayer.control = "play"
        end if
        if (key = "pause")
            handled = true
            m.videoPlayer.control = "pause"
        end if
        if (key = "OK")
            handled = true
            openYoutube()
        end if
    end if
    return handled
end function

sub openYoutube()
    appID = 837
    ipAddrs = CreateObject("roDeviceInfo").GetIPAddrs()
    IP = ipAddrs.Items()[0].value
    if ipAddrs.eth0 <> invalid
        url = "http://" + IP + ":8060/launch/" + "5G3Kvo5dlGE"
    else
        url = "http://" + IP + ":8060/launch/" + "5G3Kvo5dlGE"
    end if

    request = CreateObject("roUrlTransfer")
    request.SetUrl(url)
    request.AsyncPostFromString(url)
    urlEvent = request.head()
end sub