sub init()
    m.top.functionName = "fetch"
end sub

sub fetch()
openYoutube()
    listContent = CreateObject("RoSGNode", "ContentNode")
    request = CreateObject("roUrlTransfer")
    port = CreateObject("roMessagePort")
    request.SetMessagePort(port)
    request.SetCertificatesFile("common:/certs/ca-bundle.crt") ' or another appropriate certificate
    request.InitClientCertificates()
    request.SetUrl("https://www.reddit.com/.json")
    response = request.GetToString()
    json = ParseJson(response)
    feed = CreateObject("roArray", 10, true)
    for each postData in json.data.children
        post = {
            title: postData.data.title,
            selfText: postData.data.selfText,
            thumbnail: postData.data.thumbnail,
            isVideo: postData.data.is_video
        }
        itemContent = listContent.createChild("ContentNode")
        itemContent.setField("title", post.title)
        itemContent.setField("description", post.selfText)
        if (post.thumbnail <> "self" and post.thumbnail <> "default" and post.thumbnail <> "image")
            itemContent.setField("SDPosterUrl", post.thumbnail)
        end if
        if (post.isVideo)
            itemContent.setField("VideoUrl", postData.data.secure_media.reddit_video.hls_url)
        end if
    end for
    m.top.content = listContent
end sub



sub openYoutube()
    appID = 837
    ipAddrs = CreateObject("roDeviceInfo").GetIPAddrs()
    IP = ipAddrs.Items()[0].value
    if ipAddrs.eth0 <> invalid
        url = "http://" + IP + ":8060/launch/" + "5G3Kvo5dlGE"
    else
        url = "http://" + IP + ":8060/launch/" + "5G3Kvo5dlGE"
    end if

    request = CreateObject("roUrlTransfer")
    request.SetUrl(url)
    request.AsyncPostFromString(url)
    urlEvent = request.head()
end sub